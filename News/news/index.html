<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>News Details | Studio4Core</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../../assets/css/style.css">
<link rel="stylesheet" href="../../assets/css/detailproject.css">

<style>
  /* Loading State */
  #loading { 
    text-align: center; 
    padding: 100px 20px; 
    font-size: 1.2rem; 
    color: #888; 
  }
  .error-msg {
    color: red;
    text-align: center;
    padding: 100px;
  }
  
  /* Preserve line breaks from Sheet */
  .component-text {
    white-space: pre-line; 
  }

  /* Gallery Grid Style */
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 40px;
  }
  .gallery-grid img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
    transition: transform 0.3s;
  }
  .gallery-grid img:hover {
    transform: translateY(-5px);
  }
  /* =========================================
   LIGHTBOX NAVIGATION STYLES
   ========================================= */
.lightbox-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background-color: rgba(255, 255, 255, 0.1);
  color: white;
  border: none;
  font-size: 3rem;
  padding: 10px 20px;
  cursor: pointer;
  z-index: 1002;
  border-radius: 5px;
  user-select: none;
  transition: background 0.3s;
}
.lightbox-nav:hover {
  background-color: rgba(255, 255, 255, 0.3);
  color: #ffffff;
}
.lightbox-prev { left: 20px; }
.lightbox-next { right: 20px; }

@media (max-width: 600px) {
  .lightbox-nav { font-size: 2rem; padding: 5px 10px; }
  .lightbox-prev { left: 10px; }
  .lightbox-next { right: 10px; }
}
</style>
</head>

<body>

<header class="site-header">
    <div class="header-inner">
      <a class="brand" href="../../">Studio4Core</a>

      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <nav class="site-nav" aria-label="Primary navigation">
        <ul>
          <li><a href="../../assets/projects/">Services</a></li>
          <li><a href="../../AboutUs/">About</a></li>
          <li><a href="../../News/">News</a></li>
          <li><a href="../../assets/contact/">Contact</a></li>
        </ul>
      </nav>
    </div>
</header>

<main class="component-body" id="dynamic-content">
  <div id="loading">Loading news details...</div>
</main>

  <footer id="footer">
    <div class="footer-top">
      <div class="footer-grid">
        <div>
          <h2 class="footer-brand">Studio4Core</h2>
          <p>Global infrastructure built for modern applications and distributed teams.</p>
        </div>

        <div>
          <h4>Services</h4>
          <a href="../../assets/projects/Architecture/?filter=Architecture">Architecture</a>
          <a href="../../assets/projects/Architecture/?filter=Interior_Design">Interior Design</a>
          <a href="../../assets/projects/Architecture/?filter=Landscape">Landscape</a>
          <a href="../../assets/projects/Architecture/?filter=Urban_Design">Urban Design</a>
        </div>
        <div>
          <h4>Company</h4>
          <a href="../../AboutUs/">About</a>
          <a href="../News/">News</a>
          <a href="../../assets/contact/">Contact us</a>
        </div>

        <div class="social">
          <a href="https://www.instagram.com" target="_blank">
            <img src="../../assets/images/social logo/instagram.png" alt="Instagram" width="24">
          </a>
          <a href="https://www.facebook.com" target="_blank">
            <img src="../../assets/images/social logo/facebook.png" alt="Facebook" width="24">
          </a>
          <a href="https://www.linkedin.com" target="_blank">
            <img src="../../assets/images/social logo/linkedin.png" alt="LinkedIn" width="24">
          </a>
          <a href="https://www.twitter.com" target="_blank">
            <img src="../../assets/images/social logo/twitter.png" alt="Twitter" width="24">
          </a>
          <a href="https://www.whatsapp.com" target="_blank">
            <img src="../../assets/images/social logo/whatsapp.png" alt="WhatsApp" width="24">
          </a>
          <a href="https://www.youtube.com" target="_blank">
            <img src="../../assets/images/social logo/youtube.png" alt="YouTube" width="24">
          </a>
        </div>

      </div>
    </div>
    <div class="line-break"></div>

    <div class="location">
      <a href="https://www.youtube.com" target="_blank">
        <img src="../../assets/images/social logo/location.png" alt="Pune" width="24">Pune
      </a>
      <a href="https://www.youtube.com" target="_blank">
        <img src="../../assets/images/social logo/location.png" alt="Mumbai" width="24">Mumbai
      </a>
      <a href="https://www.youtube.com" target="_blank">
        <img src="../../assets/images/social logo/location.png" alt="Delhi" width="24">Delhi
      </a>
    </div>
    <div class="line-break"></div>

    <div class="footer-bottom">
      Â© 2025 Studio4Core. All rights reserved.
    </div>
  </footer>

<div id="lightbox" class="lightbox">
  <span class="lightbox-close">&times;</span>
  
  <button class="lightbox-nav lightbox-prev" id="lb-prev">&#10094;</button>
  <button class="lightbox-nav lightbox-next" id="lb-next">&#10095;</button>
  
  <img id="lightbox-img" class="lightbox-content">
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script src="../../assets/js/script.js"></script>
<script>

function processImg(url) {
    if(!url) return "https://via.placeholder.com/800x600?text=No+Image"; 
    url = url.trim();

    // Fix Google Drive Links to use Thumbnail endpoint (Avoids permissions/virus warnings)
    if (url.includes('drive.google.com')) {
        const idMatch = url.match(/\/d\/([a-zA-Z0-9_-]+)/); // Matches /d/ID
        if (idMatch && idMatch[1]) {
            return `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w4000`;
        }
        // Fallback for ID= style links
        if (url.includes("id=")) {
            const params = new URLSearchParams(url.split('?')[1]);
            const id = params.get("id");
            if(id) return `https://drive.google.com/thumbnail?id=${id}&sz=w4000`;
        }
    }
    
    // Normal Links
    const IMAGE_PREFIX = ""; 
    if(IMAGE_PREFIX && !url.startsWith("http")) return IMAGE_PREFIX + url;
    return url;
}

// ==========================================
// 2. MAIN LOGIC
// ==========================================
async function loadArticle() {
    const container = document.getElementById("dynamic-content");
    const urlParams = new URLSearchParams(window.location.search);
    const articleToFind = urlParams.get('article'); 

    if(!articleToFind) {
        container.innerHTML = "<div class='error-msg'>No article specified.<br><a href='news.html'>Back to News</a></div>";
        return;
    }

    const sheetId = '1gtu1WSMvPOrPn1qzD2smIdSajVTqeOmH272c9LW6a1c';
    const sheetName = 'News%20cards'; 
    const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(sheetName)}`;

    try {
        const response = await fetch(url);
        const csvText = await response.text();

        // USE PAPAPARSE (Like your Team Page)
        Papa.parse(csvText, {
            header: false,
            complete: function(results) {
                const rows = results.data;
                // Skip Header (Row 1 is usually header in Google Sheet export)
                // Use .find to locate the specific article title
                const myArticle = rows.find(row => row[8] && row[8].trim() === articleToFind.trim());

                if (myArticle) {
                    renderPage(myArticle);
                } else {
                    container.innerHTML = `<div class='error-msg'>Article "${articleToFind}" not found.</div>`;
                }
            }
        });

    } catch (error) {
        console.error("Error:", error);
        container.innerHTML = "<div class='error-msg'>Error loading data.</div>";
    }
}

// ==========================================
// 3. RENDER FUNCTION
// ==========================================
function renderPage(row) {
    const container = document.getElementById('dynamic-content');

    // MAPPING (Based on your News Sheet):
    // I(8)=Title, J(9)=Hero, K(10)=Desc, L(11)=Side, M(12)=Gallery
    const p = {
        title:       row[8],
        heroImage:   row[9],
        description: row[10],
        sideImage:   row[11],
        galleryRaw:  row[12] || "" 
    };

    // Process Images
    const heroImg = processImg(p.heroImage);
    const sideImg = processImg(p.sideImage);

    // Process Gallery
    const galleryHTML = p.galleryRaw.split(',')
        .map(u => u.trim())
        .filter(u => u.length > 5)
        .map(url => `<img src="${processImg(url)}" alt="Gallery">`)
        .join('');

    const galleryHeader = galleryHTML ? `<div class="single-text"><h2 class="component-title">Gallery</h2></div>` : '';

    container.innerHTML = `
      <h1 class="component-title component-head">${p.title}</h1>

      <div class="single-img">
        <img src="${heroImg}" alt="${p.title}" onerror="this.src='https://via.placeholder.com/800?text=Image+Error'">
      </div>

      <div class="img-text">
        <img src="${sideImg}" alt="Side Image" onerror="this.src='https://via.placeholder.com/600?text=Image+Error'">
        <p class="component-text">${p.description}</p>
      </div>

      ${galleryHeader}

      <div class="gallery-grid">
        ${galleryHTML}
      </div>

      <div class="paginationbox">
        <div class="prev-next-title">
          <a href="news.html">
            <span>Back to</span>
            <div class="component-title prev-next">All News</div>
          </a>
        </div>
      </div>
    `;

    setTimeout(initLightbox, 100);
}

// ==========================================
// 4. LIGHTBOX LOGIC (WITH ARROWS)
// ==========================================
function initLightbox() {
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lightbox-img");
    const closeBtn = document.querySelector(".lightbox-close");
    const nextBtn = document.getElementById("lb-next");
    const prevBtn = document.getElementById("lb-prev");
    
    // Select all images inside the dynamic content area
    const images = Array.from(document.querySelectorAll("#dynamic-content img"));
    let currentIndex = 0;

    // 1. Open Lightbox on Click
    images.forEach((img, index) => {
        img.style.cursor = "pointer"; // Visual cue
        img.addEventListener("click", () => {
            currentIndex = index;
            updateLightboxImage();
            lb.style.display = "flex";
        });
    });

    // 2. Helper to switch image
    function updateLightboxImage() {
        if(images[currentIndex]) {
            lbImg.src = images[currentIndex].src;
        }
    }

    // 3. Next/Prev Logic
    function showNext() {
        currentIndex++;
        if (currentIndex >= images.length) currentIndex = 0; // Loop to start
        updateLightboxImage();
    }

    function showPrev() {
        currentIndex--;
        if (currentIndex < 0) currentIndex = images.length - 1; // Loop to end
        updateLightboxImage();
    }

    // 4. Button Events
    nextBtn.onclick = (e) => { e.stopPropagation(); showNext(); };
    prevBtn.onclick = (e) => { e.stopPropagation(); showPrev(); };

    // 5. Keyboard Events (Left/Right/Esc)
    document.onkeydown = (e) => {
        if (lb.style.display === "flex") {
            if (e.key === "ArrowRight") showNext();
            if (e.key === "ArrowLeft") showPrev();
            if (e.key === "Escape") lb.style.display = "none";
        }
    };

    // 6. Close Events
    closeBtn.onclick = () => lb.style.display = "none";
    lb.onclick = (e) => {
        if (e.target === lb) lb.style.display = "none";
    };
}

document.addEventListener("DOMContentLoaded", loadArticle);
</script>
</body>
</html>