<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>News Details | CreateSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../assets/css/style.css">
<link rel="stylesheet" href="../assets/css/detailproject.css">

<style>
  /* Loading State */
  #loading { 
    text-align: center; 
    padding: 100px 20px; 
    font-size: 1.2rem; 
    color: #888; 
  }
  .error-msg {
    color: red;
    text-align: center;
    padding: 100px;
  }
  
  /* Preserve line breaks from Sheet */
  .component-text {
    white-space: pre-line; 
  }

  /* Gallery Grid Style */
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 40px;
  }
  .gallery-grid img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
    transition: transform 0.3s;
  }
  .gallery-grid img:hover {
    transform: translateY(-5px);
  }
</style>
</head>

<body>

<header class="site-header">
    <div class="header-inner">
      <a class="brand" href="../index.html">CreateSpace</a>

      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <nav class="site-nav" aria-label="Primary navigation">
        <ul>
          <li><a href="../assets/projects/Services.html">Services</a></li>
          <li><a href="../AboutUs/aboutus.html">About</a></li>
          <li><a href="../News/News.html">News</a></li>
          <li><a href="../assets/contact/contact.html">Contact</a></li>
        </ul>
      </nav>
    </div>
</header>

<main class="component-body" id="dynamic-content">
  <div id="loading">Loading news details...</div>
</main>

<footer id="footer">
    <div class="footer-top">
      <div class="footer-grid">
        <div>
          <h2 class="footer-brand">CreateSpace</h2>
          <p>Global infrastructure built for modern applications and distributed teams.</p>
        </div>
        <div>
          <h4>Services</h4>
          <a href="../assets/projects/Architecture/Architecture.html?filter=Architecture">Architecture</a>
          <a href="../assets/projects/Architecture/Architecture.html?filter=Interior_Design">Interior Design</a>
          <a href="../assets/projects/Architecture/Architecture.html?filter=Landscape">Landscape</a>
          <a href="../assets/projects/Architecture/Architecture.html?filter=Urban_Design">Urban Design</a>
        </div>
        <div>
          <h4>Company</h4>
          <a href="../AboutUs/aboutus.html">About</a>
          <a href="../News/News.html">News</a>
          <a href="../assets/contact/contact.html">Contact us</a>
        </div>
        <div class="social">
          <a href="#"><img src="../assets/images/social logo/instagram.png" alt="Insta"></a>
          <a href="#"><img src="../assets/images/social logo/facebook.png" alt="FB"></a>
          <a href="#"><img src="../assets/images/social logo/linkedin.png" alt="Li"></a>
          <a href="#"><img src="../assets/images/social logo/twitter.png" alt="Twitter"></a>
          <a href="#"><img src="../assets/images/social logo/whatsapp.png" alt="WhatsApp"></a>
          <a href="#"><img src="../assets/images/social logo/youtube.png" alt="YouTube"></a>
        </div>
      </div>
    </div>
    <div class="line-break"></div>
    <div class="location">
      <a href="#"><img src="../assets/images/social logo/location.png" alt="Loc">Pune</a>
      <a href="#"><img src="../assets/images/social logo/location.png" alt="Loc">Mumbai</a>
      <a href="#"><img src="../assets/images/social logo/location.png" alt="Loc">Delhi</a>
    </div>
    <div class="footer-bottom">Â© 2025 CreateSpace. All rights reserved.</div>
</footer>

<div id="lightbox" class="lightbox">
  <span class="lightbox-close">&times;</span>
  <img id="lightbox-img">
</div>

<script>
// ==========================================
// 1. CONFIGURATION
// ==========================================
const SHEET_ID = '1gtu1WSMvPOrPn1qzD2smIdSajVTqeOmH272c9LW6a1c';

// UPDATED SHEET NAME
const SHEET_NAME = 'News cards'; 

const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
const IMAGE_PREFIX = ""; 

// ==========================================
// 2. MAIN LOGIC
// ==========================================
const urlParams = new URLSearchParams(window.location.search);
// We look for ?article=Title in the URL
const articleToFind = urlParams.get('article'); 

document.addEventListener("DOMContentLoaded", function() {
    // Mobile Menu Logic
    const menuToggle = document.querySelector('.menu-toggle');
    const siteNav = document.querySelector('.site-nav');
    if (menuToggle) {
        menuToggle.addEventListener('click', () => {
            siteNav.classList.toggle('active');
            menuToggle.classList.toggle('active');
        });
    }

    if(!articleToFind) {
        document.getElementById('dynamic-content').innerHTML = "<div class='error-msg'>No article specified.<br><a href='../News/News.html'>Back to News</a></div>";
        return;
    }

    fetch(SHEET_URL)
    .then(r => r.text())
    .then(csvText => {
        const articles = parseCSV(csvText);
        // Find the matching article title (Trimming spaces to be safe)
        const myArticle = articles.find(a => a.title.trim() === articleToFind.trim());
        
        if(myArticle) {
            renderPage(myArticle);
        } else {
            document.getElementById('dynamic-content').innerHTML = `<div class='error-msg'>Article "${articleToFind}" not found.</div>`;
        }
    });
});

// ==========================================
// 3. RENDER FUNCTION
// ==========================================
function renderPage(p) {
    const container = document.getElementById('dynamic-content');
    
    // Process Images
    const heroImg = processImg(p.heroImage);
    const sideImg = processImg(p.sideImage);
    
    // Process Gallery
    // Filters out empty entries
    const galleryImages = p.galleryRaw.split(',').map(url => url.trim()).filter(url => url.length > 0);
    let galleryHTML = "";
    galleryImages.forEach(url => {
        galleryHTML += `<img src="${processImg(url)}" alt="Gallery Image">`;
    });

    // Only show "Gallery" header if there are images
    const gallerySectionHeader = galleryHTML ? `<div class="single-text"><h2 class="component-title">Gallery</h2></div>` : '';

    container.innerHTML = `
      <h1 class="component-title component-head">${p.title}</h1>

      <div class="single-img">
        <img src="${heroImg}" alt="${p.title}">
      </div>

      <div class="img-text">
        <img src="${sideImg}" alt="Side Image">
        <p class="component-text">${p.description}</p>
      </div>

      ${gallerySectionHeader}

      <div class="gallery-grid">
        ${galleryHTML}
      </div>

    `;

    initLightbox();
}

// ==========================================
// 4. PARSE CSV (UPDATED COLUMN MAPPING)
// ==========================================
function parseCSV(csv) {
    const lines = csv.split("\n");
    const result = [];
    
    // Start at row 1 (Assuming Row 1 is Header)
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        // Regex split to handle commas inside quotes
        const cols = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(cleanText);

        // === CORRECT MAPPING (Targeting Column M for Gallery) ===
        // I=8, J=9, K=10, L=11, M=12
        
        const p = {
            title:       cols[8],       // Column I
            heroImage:   cols[9],       // Column J
            description: cols[10],      // Column K
            sideImage:   cols[11],      // Column L
            galleryRaw:  cols[12] || "" // Column M (Index 12)
        };

        if(p.title) result.push(p);
    }
    return result;
}

function cleanText(text) {
    if (!text) return "";
    return text.replace(/^"|"$/g, '').trim(); 
}

function processImg(url) {
    if(!url) return "https://via.placeholder.com/800x600?text=No+Image"; 
    url = url.trim();
    if(IMAGE_PREFIX && !url.startsWith("http")) return IMAGE_PREFIX + url;
    return url;
}

function initLightbox() {
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lightbox-img");
    const close = document.querySelector(".lightbox-close");

    document.querySelectorAll("#dynamic-content img").forEach(img => {
        img.addEventListener("click", () => {
            lb.style.display = "flex";
            lbImg.src = img.src;
        });
    });

    close.onclick = () => lb.style.display = "none";
    lb.onclick = e => { if(e.target === lb) lb.style.display = "none"; };
}
</script>

</body>
</html>