<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Project Details | CreateSpace</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../../../css/style.css">

<link rel="stylesheet" href="../../../css/detailproject.css">

<style>
  /* Loading State */
  #loading { 
    text-align: center; 
    padding: 100px 20px; 
    font-size: 1.2rem; 
    color: #888; 
  }
  .error-msg {
    color: red;
    text-align: center;
    padding: 100px;
  }
  
  /* Preserve Paragraphs from Sheet */
  .component-text {
    white-space: pre-line; 
  }

  /* Gallery Grid Style */
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 40px;
  }
  .gallery-grid img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
    transition: transform 0.3s;
  }
  .gallery-grid img:hover {
    transform: translateY(-5px);
  }
  /* =========================================
   LIGHTBOX NAVIGATION STYLES
   ========================================= */
.lightbox-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background-color: rgba(255, 255, 255, 0.1);
  color: white;
  border: none;
  font-size: 3rem;
  padding: 10px 20px;
  cursor: pointer;
  z-index: 1002;
  border-radius: 5px;
  user-select: none;
  transition: background 0.3s;
}
.lightbox-nav:hover {
  background-color: rgba(255, 255, 255, 0.3);
  color: #f0c14a;
}
.lightbox-prev { left: 20px; }
.lightbox-next { right: 20px; }

@media (max-width: 600px) {
  .lightbox-nav { font-size: 2rem; padding: 5px 10px; }
  .lightbox-prev { left: 10px; }
  .lightbox-next { right: 10px; }
}
</style>
</head>

<body>

<header class="site-header">
    <div class="header-inner">
      <a class="brand" href="../../../../">CreateSpace</a>

      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <nav class="site-nav" aria-label="Primary navigation">
        <ul>
          <li><a href="../../">Services</a></li>
          <li><a href="../../../../AboutUs/">About</a></li>
          <li><a href="../../../../News/">News</a></li>
          <li><a href="../../../contact/">Contact</a></li>
        </ul>
      </nav>
    </div>
</header>

<main class="component-body" id="dynamic-content">
  <div id="loading">Loading project details...</div>
</main>

<footer id="footer">
    <div class="footer-top">
      <div class="footer-grid">
        <div>
          <h2 class="footer-brand">CreateSpace</h2>
          <p>Global infrastructure built for modern applications and distributed teams.</p>
        </div>
        <div>
          <h4>Services</h4>
          <a href="../../../projects/Architecture/?filter=Architecture">Architecture</a>
          <a href="../../../projects/Architecture/?filter=Interior_Design">Interior Design</a>
          <a href="../../../projects/Architecture/?filter=Landscape">Landscape</a>
          <a href="../../../projects/Architecture/?filter=Urban Design">Urban Design</a>
        </div>
        <div>
          <h4>Company</h4>
          <a href="../../../../AboutUs/">About</a>
          <a href="../../../../News/">News</a>
          <a href="../../../contact/">Contact us</a>
        </div>
        <div class="social">
          <a href="#"><img src="../../../images/social logo/instagram.png" alt="Insta"></a>
          <a href="#"><img src="../../../images/social logo/facebook.png" alt="FB"></a>
          <a href="#"><img src="../../../images/social logo/linkedin.png" alt="Li"></a>
          <a href="#"><img src="../../../images/social logo/twitter.png" alt="Twitter"></a>
          <a href="#"><img src="../../../images/social logo/whatsapp.png" alt="WhatsApp"></a>
          <a href="#"><img src="../../../images/social logo/youtube.png" alt="YouTube"></a>
        </div>
      </div>
    </div>
    <div class="line-break"></div>
    <div class="location">
      <a href="#"><img src="../../../images/social logo/location.png" alt="Loc">Pune</a>
      <a href="#"><img src="../../../images/social logo/location.png" alt="Loc">Mumbai</a>
      <a href="#"><img src="../../../images/social logo/location.png" alt="Loc">Delhi</a>
    </div>
    <div class="footer-bottom">Â© 2025 CreateSpace. All rights reserved.</div>
</footer>
<div id="lightbox" class="lightbox">
  <span class="lightbox-close">&times;</span>
  
  <button class="lightbox-nav lightbox-prev" id="lb-prev">&#10094;</button>
  <button class="lightbox-nav lightbox-next" id="lb-next">&#10095;</button>
  
  <img id="lightbox-img" class="lightbox-content">
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<script>
// ==========================================
// 1. CONFIGURATION
// ==========================================
const SHEET_ID = '1gtu1WSMvPOrPn1qzD2smIdSajVTqeOmH272c9LW6a1c';
const SHEET_NAME = 'project details'; 
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
const IMAGE_PREFIX = ""; 

// ==========================================
// 2. HELPER: FIX GOOGLE DRIVE IMAGES
// ==========================================
function processImg(url) {
    if(!url) return "https://via.placeholder.com/800x600?text=No+Image"; 
    url = url.trim();

    // Convert Drive Link to Thumbnail Link (Bypasses permissions/virus warnings)
    if (url.includes('drive.google.com')) {
        const idMatch = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (idMatch && idMatch[1]) {
            // Request large image (w4000) for details page
            return `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w4000`;
        }
    }
    
    // Normal Links
    if(IMAGE_PREFIX && !url.startsWith("http")) return IMAGE_PREFIX + url;
    return url;
}

// ==========================================
// 3. MAIN LOGIC
// ==========================================
const urlParams = new URLSearchParams(window.location.search);
const projectToFind = urlParams.get('project'); 

document.addEventListener("DOMContentLoaded", function() {
    // Mobile Menu
    const menuToggle = document.querySelector('.menu-toggle');
    const siteNav = document.querySelector('.site-nav');
    if (menuToggle) {
        menuToggle.addEventListener('click', () => {
            siteNav.classList.toggle('active');
            menuToggle.classList.toggle('active');
        });
    }

    if(!projectToFind) {
        document.getElementById('dynamic-content').innerHTML = "<div class='error-msg'>No project specified.<br><a href='Architecture.html'>Go back to projects</a></div>";
        return;
    }

    // Fetch and Parse
    fetch(SHEET_URL)
    .then(r => r.text())
    .then(csvText => {
        Papa.parse(csvText, {
            header: false,
            complete: function(results) {
                const rows = results.data;
                // Find matching project by Title (Column C -> Index 2)
                const myProjectRow = rows.find(row => row[2] && row[2].trim() === projectToFind.trim());
                
                if(myProjectRow) {
                    // Map the row array to an object
                    const p = mapRowToProject(myProjectRow);
                    renderPage(p);
                } else {
                    document.getElementById('dynamic-content').innerHTML = `<div class='error-msg'>Project "${projectToFind}" not found.</div>`;
                }
            }
        });
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('dynamic-content').innerHTML = `<div class='error-msg'>Error loading data.</div>`;
    });
});

// ==========================================
// 4. MAP ROW TO OBJECT
// ==========================================
function mapRowToProject(cols) {
    // MAPPING based on your previous code:
    // B=1(Category), C=2(Title), D=3(Hero), E=4(Desc), 
    // F=5(Client), G=6(Location), H=7(Status), I=8(Area), 
    // J=9(DescImg), K=10(Gallery)
    
    return {
        category:    cols[1],
        title:       cols[2],
        heroImage:   cols[3],
        description: cols[4],
        client:      cols[5],
        location:    cols[6],
        status:      cols[7],
        area:        cols[8],
        descImage:   cols[9],
        galleryRaw:  cols[10] || ""
    };
}

// ==========================================
// 5. RENDER FUNCTION
// ==========================================
function renderPage(p) {
    const container = document.getElementById('dynamic-content');
    
    // Process Images
    const heroImg = processImg(p.heroImage);
    const descImg = processImg(p.descImage);
    
    // Process Gallery
    const galleryHTML = p.galleryRaw.split(',')
        .map(u => u.trim())
        .filter(u => u.length > 5)
        .map(url => `<img src="${processImg(url)}" alt="Gallery Image">`)
        .join('');

    container.innerHTML = `
      <h1 class="component-title component-head">${p.title}</h1>

      <div class="single-img">
        <img src="${heroImg}" alt="${p.title}" onerror="this.src='https://via.placeholder.com/800x600?text=Image+Error'">
      </div>

      <div class="component-menu">
        <div><p class="component-menu-title">Project Client</p><p>${p.client || 'N/A'}</p></div>
        <div><p class="component-menu-title">Project Category</p><p>${p.category}</p></div>
        <div><p class="component-menu-title">Location</p><p>${p.location || 'N/A'}</p></div>
        <div><p class="component-menu-title">Status</p><p>${p.status || 'Completed'}</p></div>
        <div><p class="component-menu-title">Area</p><p>${p.area || 'N/A'}</p></div>
      </div>

      <div class="img-text">
        <img src="${descImg}" alt="Detail Shot" onerror="this.src='https://via.placeholder.com/600x400?text=Image+Error'">
        <p class="component-text">${p.description}</p>
      </div>

      <div class="single-text">
        <h2 class="component-title">Photos</h2>
      </div>

      <div class="gallery-grid">
        ${galleryHTML}
      </div>

      <div class="paginationbox">
        <div class="prev-next-title">
          <a href="../">
            <span>Back to</span>
            <div class="component-title prev-next">All Projects</div>
          </a>
        </div>
      </div>
    `;

   setTimeout(initLightbox, 100);
}

// ==========================================
// 6. LIGHTBOX LOGIC (UPGRADED)
// ==========================================
function initLightbox() {
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lightbox-img");
    const closeBtn = document.querySelector(".lightbox-close");
    const nextBtn = document.getElementById("lb-next");
    const prevBtn = document.getElementById("lb-prev");

    // Select all images inside dynamic-content
    const images = Array.from(document.querySelectorAll("#dynamic-content img"));
    let currentIndex = 0;

    // 1. Open Lightbox on Click
    images.forEach((img, index) => {
        img.style.cursor = "pointer"; 
        img.addEventListener("click", () => {
            currentIndex = index;
            updateLightboxImage();
            lb.style.display = "flex";
        });
    });

    // 2. Helper to switch image
    function updateLightboxImage() {
        if(images[currentIndex]) {
            lbImg.src = images[currentIndex].src;
        }
    }

    // 3. Next/Prev Logic
    function showNext() {
        currentIndex++;
        if (currentIndex >= images.length) currentIndex = 0; 
        updateLightboxImage();
    }

    function showPrev() {
        currentIndex--;
        if (currentIndex < 0) currentIndex = images.length - 1; 
        updateLightboxImage();
    }

    // 4. Button Events
    nextBtn.onclick = (e) => { e.stopPropagation(); showNext(); };
    prevBtn.onclick = (e) => { e.stopPropagation(); showPrev(); };

    // 5. Keyboard Events
    document.onkeydown = (e) => {
        if (lb.style.display === "flex") {
            if (e.key === "ArrowRight") showNext();
            if (e.key === "ArrowLeft") showPrev();
            if (e.key === "Escape") lb.style.display = "none";
        }
    };

    // 6. Close Events
    closeBtn.onclick = () => lb.style.display = "none";
    lb.onclick = (e) => {
        if (e.target === lb) lb.style.display = "none";
    };
}
</script>
<script src="../../../js/script.js"></script>
</body>
</html>