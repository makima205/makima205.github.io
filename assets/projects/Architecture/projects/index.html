<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Project Details | Studio4Core</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="../../../css/style.css">
<link rel="stylesheet" href="../../../css/detailproject.css">

<style>
  /* Loading State */
  #loading { 
    text-align: center; 
    padding: 100px 20px; 
    font-size: 1.2rem; 
    color: #888; 
  }
  .error-msg {
    color: red;
    text-align: center;
    padding: 100px;
  }
  
  /* Preserve Paragraphs from Sheet */
  .component-text {
    white-space: pre-line; 
  }

  /* Gallery Grid Style */
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 40px;
  }
  .gallery-grid img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    border-radius: 4px;
    cursor: pointer;
    transition: transform 0.3s;
  }
  .gallery-grid img:hover {
    transform: translateY(-5px);
  }
/* =========================================
    YOUTUBE "CINEMATIC CROP" STYLE (NO ZOOM)
    ========================================= */
.video-hero-container {
  position: relative;
  width: 100%;
  /* Standard 16:9 ratio is 56.25%. 
     We use 45% to make the container SHORTER. 
     This forces the top and bottom of the video to get cut off.
  */
  padding-bottom: 45%; 
  height: 0;
  background: #000;
  overflow: hidden; /* CRITICAL: Clips the excess top/bottom */
  margin-bottom: 30px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

.video-hero-container iframe {
  position: absolute;
  /* NO ZOOM applied here. Width stays 100% for maximum sharpness. */
  width: 100%;    
  /* We make the iframe taller than the container */
  height: 125%;   
  /* Center the video vertically so it crops evenly */
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  
  border: 0;
  pointer-events: none; /* Makes it unclickable */
}

  /* =========================================
     LIGHTBOX NAVIGATION STYLES
     ========================================= */
  .lightbox-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: rgba(255, 255, 255, 0.1);
    color: white;
    border: none;
    font-size: 3rem;
    padding: 10px 20px;
    cursor: pointer;
    z-index: 1002;
    border-radius: 5px;
    user-select: none;
    transition: background 0.3s;
  }
  .lightbox-nav:hover {
    background-color: rgba(255, 255, 255, 0.3);
    color: #f0c14a;
  }
  .lightbox-prev { left: 20px; }
  .lightbox-next { right: 20px; }

  @media (max-width: 600px) {
    .lightbox-nav { font-size: 2rem; padding: 5px 10px; }
    .lightbox-prev { left: 10px; }
    .lightbox-next { right: 10px; }
  }
</style>
</head>

<body>

<header class="site-header">
    <div class="header-inner">
      <a class="brand" href="../../../../">CreateSpace</a>

      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span></span><span></span><span></span>
      </button>

      <nav class="site-nav" aria-label="Primary navigation">
        <ul>
          <li><a href="../../">Services</a></li>
          <li><a href="../../../../AboutUs/">About</a></li>
          <li><a href="../../../../News/">News</a></li>
          <li><a href="../../../contact/">Contact</a></li>
        </ul>
      </nav>
    </div>
</header>

<main class="component-body" id="dynamic-content">
  <div id="loading">Loading project details...</div>
</main>

<footer id="footer">
    <div class="footer-top">
      <div class="footer-grid">
        <div>
          <h2 class="footer-brand">CreateSpace</h2>
          <p>Global infrastructure built for modern applications and distributed teams.</p>
        </div>
        <div>
          <h4>Services</h4>
          <a href="../../../projects/Architecture/?filter=Architecture">Architecture</a>
          <a href="../../../projects/Architecture/?filter=Interior_Design">Interior Design</a>
          <a href="../../../projects/Architecture/?filter=Landscape">Landscape</a>
          <a href="../../../projects/Architecture/?filter=Urban Design">Urban Design</a>
        </div>
        <div>
          <h4>Company</h4>
          <a href="../../../../AboutUs/">About</a>
          <a href="../../../../News/">News</a>
          <a href="../../../contact/">Contact us</a>
        </div>
        <div class="social">
          <a href="#"><img src="../../../images/social logo/instagram.png" alt="Insta"></a>
          <a href="#"><img src="../../../images/social logo/facebook.png" alt="FB"></a>
          <a href="#"><img src="../../../images/social logo/linkedin.png" alt="Li"></a>
          <a href="#"><img src="../../../images/social logo/twitter.png" alt="Twitter"></a>
          <a href="#"><img src="../../../images/social logo/whatsapp.png" alt="WhatsApp"></a>
          <a href="#"><img src="../../../images/social logo/youtube.png" alt="YouTube"></a>
        </div>
      </div>
    </div>
    <div class="line-break"></div>
    <div class="location">
      <a href="#"><img src="../../../images/social logo/location.png" alt="Loc">Pune</a>
      <a href="#"><img src="../../../images/social logo/location.png" alt="Loc">Mumbai</a>
      <a href="#"><img src="../../../images/social logo/location.png" alt="Loc">Delhi</a>
    </div>
    <div class="footer-bottom">Â© 2025 CreateSpace. All rights reserved.</div>
</footer>

<div id="lightbox" class="lightbox">
  <span class="lightbox-close">&times;</span>
  <button class="lightbox-nav lightbox-prev" id="lb-prev">&#10094;</button>
  <button class="lightbox-nav lightbox-next" id="lb-next">&#10095;</button>
  <img id="lightbox-img" class="lightbox-content">
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<script>
// ==========================================
// 1. CONFIGURATION
// ==========================================
const SHEET_ID = '1gtu1WSMvPOrPn1qzD2smIdSajVTqeOmH272c9LW6a1c';
const SHEET_NAME = 'project details'; 
const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(SHEET_NAME)}`;
const IMAGE_PREFIX = ""; 

// ==========================================
// 2. HELPER: FIX GOOGLE DRIVE IMAGES & VIDEO
// ==========================================
function processImg(url) {
    if(!url) return "https://via.placeholder.com/800x600?text=No+Image"; 
    url = url.trim();

    // Convert Drive Link to Thumbnail Link
    if (url.includes('drive.google.com')) {
        const idMatch = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
        if (idMatch && idMatch[1]) {
            return `https://drive.google.com/thumbnail?id=${idMatch[1]}&sz=w4000`;
        }
    }
    if(IMAGE_PREFIX && !url.startsWith("http")) return IMAGE_PREFIX + url;
    return url;
}


// ==========================================
// 3. MAIN LOGIC
// ==========================================
const urlParams = new URLSearchParams(window.location.search);
const projectToFind = urlParams.get('project'); 

document.addEventListener("DOMContentLoaded", function() {
    // Mobile Menu
    const menuToggle = document.querySelector('.menu-toggle');
    const siteNav = document.querySelector('.site-nav');
    if (menuToggle) {
        menuToggle.addEventListener('click', () => {
            siteNav.classList.toggle('active');
            menuToggle.classList.toggle('active');
        });
    }

    if(!projectToFind) {
        document.getElementById('dynamic-content').innerHTML = "<div class='error-msg'>No project specified.<br><a href='Architecture.html'>Go back to projects</a></div>";
        return;
    }

    fetch(SHEET_URL)
    .then(r => r.text())
    .then(csvText => {
        Papa.parse(csvText, {
            header: false,
            complete: function(results) {
                const rows = results.data;
                const myProjectRow = rows.find(row => row[2] && row[2].trim() === projectToFind.trim());
                
                if(myProjectRow) {
                    const p = mapRowToProject(myProjectRow);
                    renderPage(p);
                } else {
                    document.getElementById('dynamic-content').innerHTML = `<div class='error-msg'>Project "${projectToFind}" not found.</div>`;
                }
            }
        });
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('dynamic-content').innerHTML = `<div class='error-msg'>Error loading data.</div>`;
    });
});

// ==========================================
// 4. MAP ROW TO OBJECT
// ==========================================
function mapRowToProject(cols) {
    // UPDATED MAPPING:
    // Added videoUrl at Column L (Index 11)
    return {
        category:    cols[1],
        title:       cols[2],
        heroImage:   cols[3],
        description: cols[4],
        client:      cols[5],
        location:    cols[6],
        status:      cols[7],
        area:        cols[8],
        descImage:   cols[9],
        galleryRaw:  cols[10] || "",
        videoUrl:    cols[11] || "" // <--- NEW VIDEO COLUMN
    };
}

function processVideo(url) {
    if (!url) return null;
    url = url.trim();
    
    // Regex matches: youtu.be/ID or youtube.com/watch?v=ID
    const ytMatch = url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?]+)/);
    
    if (ytMatch && ytMatch[1]) {
        const vidId = ytMatch[1];
        // CHANGE 1: Use 'www.youtube-nocookie.com'
        // CHANGE 2: Add 'iv_load_policy=3' to hide annotations
        return `https://www.youtube-nocookie.com/embed/${vidId}?autoplay=1&mute=1&controls=0&loop=1&playlist=${vidId}&showinfo=0&modestbranding=1&rel=0&iv_load_policy=3`;
    }

    // Dropbox Fix
    if (url.includes('dropbox.com')) {
        return url.replace('www.dropbox.com', 'dl.dropboxusercontent.com').replace('?dl=0', '');
    }

    return url;
}


/* ==========================================
   5. RENDER FUNCTION
   ========================================== */
function renderPage(p) {
    const container = document.getElementById('dynamic-content');
    
    // Process Media
    const heroImg = processImg(p.heroImage);
    const descImg = processImg(p.descImage);
    
    // Process Video URL
    const rawVideoUrl = p.videoUrl ? p.videoUrl.trim() : "";
    const processedVideoUrl = processVideo(rawVideoUrl);

    let heroMediaHTML;
    
    if (processedVideoUrl) {
        // CHECK: Is it YouTube (iframe) or Direct File (video tag)?
        if (processedVideoUrl.includes('/embed/')) {
            // RENDER YOUTUBE IFRAME
            heroMediaHTML = `
                <div class="video-hero-container">
                    <iframe 
                        src="${processedVideoUrl}" 
                        allow="autoplay; encrypted-media" 
                        allowfullscreen>
                    </iframe>
                </div>`;
        } else {
            // RENDER DIRECT VIDEO (Dropbox / GitHub)
            heroMediaHTML = `
                <div class="video-hero-container">
                    <video autoplay muted loop playsinline>
                        <source src="${processedVideoUrl}" type="video/mp4">
                    </video>
                </div>`;
        }
    } else {
        // FALLBACK: HERO IMAGE
        heroMediaHTML = `
            <div class="single-img">
                <img src="${heroImg}" alt="${p.title}" class="lightbox-trigger" onerror="this.src='https://via.placeholder.com/800x600?text=Image+Error'">
            </div>`;
    }
    
    // Process Gallery
    const galleryHTML = p.galleryRaw.split(',')
        .map(u => u.trim())
        .filter(u => u.length > 5)
        .map(url => `<img src="${processImg(url)}" alt="Gallery Image">`)
        .join('');

    container.innerHTML = `
      <h1 class="component-title component-head">${p.title}</h1>

      ${heroMediaHTML}

      <div class="component-menu">
        <div><p class="component-menu-title">Project Client</p><p>${p.client || 'N/A'}</p></div>
        <div><p class="component-menu-title">Project Category</p><p>${p.category}</p></div>
        <div><p class="component-menu-title">Location</p><p>${p.location || 'N/A'}</p></div>
        <div><p class="component-menu-title">Status</p><p>${p.status || 'Completed'}</p></div>
        <div><p class="component-menu-title">Area</p><p>${p.area || 'N/A'}</p></div>
      </div>

      <div class="img-text">
        <img src="${descImg}" alt="Detail Shot" class="lightbox-trigger" onerror="this.src='https://via.placeholder.com/600x400?text=Image+Error'">
        <p class="component-text">${p.description}</p>
      </div>

      <div class="single-text">
        <h2 class="component-title">Photos</h2>
      </div>

      <div class="gallery-grid">
        ${galleryHTML}
      </div>

      <div class="paginationbox">
        <div class="prev-next-title">
          <a href="../">
            <span>Back to</span>
            <div class="component-title prev-next">All Projects</div>
          </a>
        </div>
      </div>
    `;

    setTimeout(initLightbox, 100);
}
// ==========================================
// 6. LIGHTBOX LOGIC
// ==========================================
function initLightbox() {
    const lb = document.getElementById("lightbox");
    const lbImg = document.getElementById("lightbox-img");
    const closeBtn = document.querySelector(".lightbox-close");
    const nextBtn = document.getElementById("lb-next");
    const prevBtn = document.getElementById("lb-prev");

    const images = Array.from(document.querySelectorAll("#dynamic-content img"));
    let currentIndex = 0;

    images.forEach((img, index) => {
        img.style.cursor = "pointer"; 
        img.addEventListener("click", () => {
            currentIndex = index;
            updateLightboxImage();
            lb.style.display = "flex";
        });
    });

    function updateLightboxImage() {
        if(images[currentIndex]) {
            lbImg.src = images[currentIndex].src;
        }
    }

    function showNext() {
        currentIndex++;
        if (currentIndex >= images.length) currentIndex = 0; 
        updateLightboxImage();
    }

    function showPrev() {
        currentIndex--;
        if (currentIndex < 0) currentIndex = images.length - 1; 
        updateLightboxImage();
    }

    nextBtn.onclick = (e) => { e.stopPropagation(); showNext(); };
    prevBtn.onclick = (e) => { e.stopPropagation(); showPrev(); };

    document.onkeydown = (e) => {
        if (lb.style.display === "flex") {
            if (e.key === "ArrowRight") showNext();
            if (e.key === "ArrowLeft") showPrev();
            if (e.key === "Escape") lb.style.display = "none";
        }
    };

    closeBtn.onclick = () => lb.style.display = "none";
    lb.onclick = (e) => {
        if (e.target === lb) lb.style.display = "none";
    };
}
</script>
<script src="../../../js/script.js"></script>
</body>
</html>